import elasticsearch from 'elasticsearch'
import { config } from '@/'

let client
const configDriver = ({ options }) => {
  client = new elasticsearch.Client(options)
}

const getClient = () => {
  return new Promise((resolve, reject) => {
    if (!client) {
      return reject(new Error('Elasticsearch driver needs to be initialize'))
    }
    return resolve(client)
  })
}

const cleanDatabase = async () => { // Only cleans default application index
  if (await client.indices.exists(config.application.name)) {
    await client.indices.delete({index: config.application.name})
  }
}

const shutdown = async () => {
}

export { configDriver, getClient, shutdown, cleanDatabase }
