import { getDB } from '@/drivers/MongoDB'
import moment from 'moment'

export default class MongoMigrationPersistenceProvider {
  async getDbVersion () {
    const db = await getDB()
    const schemaInfo = await db.collection('porg_db_schema_metadata').findOne({}, { 'sort': { '_id': -1 } })
    return schemaInfo ? schemaInfo._id : 0
  }

  async setDbVersion ({ dbVersion }) {
    const db = await getDB()
    await db.collection('porg_db_schema_metadata').insertOne({ 'timestamp': moment().toDate(), '_id': dbVersion })
  }
}
