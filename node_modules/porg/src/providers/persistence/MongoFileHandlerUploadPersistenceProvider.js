import { getDB } from '@/drivers/MongoDB'

export default class MongoFileHandlerUploadPersistenceProvider {
  async getUploadSession ({ id }) {
    let db = await getDB()
    return db.collection('porg_upload_sessions').findOne({ '_id': id })
  }

  async createUploadSession ({ uploadSession }) {
    let db = await getDB()
    await db.collection('porg_upload_sessions').insertOne(uploadSession)
  }

  async setUploadSessionState ({ id, state }) {
    let db = await getDB()
    await db.collection('porg_upload_sessions').updateOne({ '_id': id }, { $set: { state } })
  }

  async insertFile ({ file }) {
    let db = await getDB()
    await db.collection('porg_files').insertOne(file)
  }

  async getFileWithChecksum ({ checksum }) {
    let db = await getDB()
    return db.collection('porg_files').findOne({ checksum })
  }
}
