import Joi from 'joi'

const handler = ({persistentTaskProvider}) => {
  return async (request, h) => {
    await persistentTaskProvider.updateTaskInstance({id: request.params.id, ...request.payload})
    return {}
  }
}

const config = ({roles, twoFactor}) => {
  return {
    description: 'Update task instance',
    validate: {
      params: {
        id: Joi.string().required()
      },
      payload: {
        killswitch: Joi.boolean(),
        executionTimeLimit: Joi.number().integer().greater(0)
      }
    },
    plugins: {
      'porg-auth': {
        type: 'user-session',
        twoFactor,
        roles
      }
    }
  }
}

export default { handler, config }
