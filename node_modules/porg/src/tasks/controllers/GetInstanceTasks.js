import StatusTask from '@/tasks/StatusTask'
import Joi from 'joi'

const handler = ({persistentTaskProvider}) => {
  return async (request, h) => {
    const tasks = await persistentTaskProvider.getTasksInstances({status: request.query.status})
    return { tasks: tasks }
  }
}

const config = ({roles, twoFactor}) => {
  return {
    description: 'Get tasks instances',
    validate: {
      query: {
        status: Joi.string().valid(Object.values(StatusTask)).required()
      }
    },
    plugins: {
      'porg-auth': {
        type: 'user-session',
        twoFactor,
        roles
      }
    }
  }
}

export default { handler, config }
