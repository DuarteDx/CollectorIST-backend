import CAS from 'simple-cas-interface'
const handler = (casOptions) => {
  return async (request, h) => {
    const opts = {
      ...casOptions
    }

    const cas = new CAS(opts)
    h.unstate('P_SESSION', {encoding: 'none', isSameSite: 'Strict', path: '/'})
    h.unstate('P_IS_LOGGED', {encoding: 'none', isSameSite: 'Strict', path: '/', isHttpOnly: false})
    return h.redirect(cas.logoutUrl)
  }
}

const config = {
  description: 'Logout',
  plugins: {
    'porg-auth': {
      type: 'user-session',
      roles: []
    }
  }
}

export default { handler, config }
