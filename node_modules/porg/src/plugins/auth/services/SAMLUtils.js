import fs from 'fs'
import * as saml2 from 'saml2-js'

export default function ({ sp, idp }) {
  return {
    sp: new saml2.ServiceProvider({
      entity_id: sp.metadataUrl,
      assert_endpoint: sp.assertUrl,
      private_key: fs.readFileSync(sp.privateKeyPath).toString(),
      certificate: fs.readFileSync(sp.certificatePath).toString(),
      allow_unencrypted_assertion: true
    }),
    idp: new saml2.IdentityProvider({
      sso_login_url: idp.loginUrl,
      sso_logout_url: idp.logoutUrl,
      certificates: [fs.readFileSync(idp.certificatePath).toString()],
      sign_get_request: false,
      allow_unencrypted_assertion: true
    })
  }
}
