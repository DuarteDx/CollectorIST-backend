import { Mongo, Elasticsearch, Consul } from '@/drivers'

export default async (options) => {
  const status = {}
  for (let key in options.drivers) {
    if (key === 'mongo') {
      const db = await Mongo.getDB()
      status.mongo = db.serverConfig.isConnected()
    } else if (key === 'elasticsearch') {
      try {
        const client = await Elasticsearch.getClient()
        const ping = await client.ping({requestTimeout: 1000})
        status.elasticsearch = ping
      } catch (err) {
        status.elasticsearch = false
      }
    } else if (key === 'consul') {
      try {
        const client = await Consul.consulClient
        await new Promise((resolve, reject) => {
          client.agent.self((err, result) => {
            if (err) {
              return reject(err)
            }
            return resolve(result)
          })
        })
        status.consul = true
      } catch (err) {
        status.consul = false
      }
    }
  }
  return status
}
