import { testCaseRunner, logger, server } from '#/TestTemplate'
const casRedirect =
  'https://cas:8443/cas/login?service=https%3A%2F%2Flocalhost%3A8080%2Fapi%2Fv1%2Fcas-st-handler%2FaHR0cHM6Ly9sb2NhbGhvc3Q6ODA4MA'
testCaseRunner('cas', 'normal', test => {
  test.test('Get cas auth', async function (t) {
    logger(['info', 'testing', 'test'], `Get cas auth`)
    const options = {
      method: 'GET',
      url: '/api/v1/cas-authenticate?callbackUrl=https://localhost:8080'
    }
    let response
    try {
      response = await server.inject(options)
    } catch (err) {
      logger(['crit', 'testing', 'test'], err.message)
    } finally {
      t.equal(response && response.headers && response.headers.location, casRedirect)
      logger(['info', 'testing', 'test'], 'Get cas auth end')
      t.end()
    }
  })
})
