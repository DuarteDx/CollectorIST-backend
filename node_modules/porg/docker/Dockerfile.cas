FROM apereo/cas:v5.1.8
COPY ./pom.xml /cas-overlay/pom.xml
COPY ./cas.properties /cas-overlay/etc/cas/config/cas.properties
COPY ./users /cas-overlay/etc/cas/config/users
COPY ./services /cas-overlay/etc/cas/config/services
RUN exec /cas-overlay/build.sh package
RUN keytool -genkey -keyalg RSA -alias cas -keystore /etc/cas/thekeystore -storepass changeit -validity 9999 -keysize 2048 -dname "cn=cas.local, ou=MyOU, o=MyCompany, c=FR, st=Nord, l=MyCity" && \
    keytool -genkey -keyalg RSA -alias cas -keystore $JAVA_HOME/lib/security/cacerts -storepass changeit -validity 9999 -keysize 2048 -dname "cn=cas.local, ou=MyOU, o=MyCompany, c=FR, st=Nord, l=MyCity"
