version: '3.1'
services:
  mongo:
    image: mongo:4
    environment:
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=root
      - MONGO_USERNAME=porg
      - MONGO_PASSWORD=porg
      - MONGO_DATABASE=porg
    volumes:
      - "$PWD/entrypoint.sh:/docker-entrypoint-initdb.d/entrypoint.sh"
  consul:
    image: consul:1.0.6
    environment:
     - 'CONSUL_LOCAL_CONFIG={"acl_master_token": "changeme"}'
    command: ["agent", "-enable-script-checks", "-dev", "-client", "0.0.0.0"]
  cas:
    build:
     context: .
     dockerfile: Dockerfile.cas
  node:
    build:
     context: .
     dockerfile: Dockerfile.node
    environment:
     - NPM_USER=gitlab-npm
     - NPM_PASS=q3RKWDrEC6r4E6Aqv2
     - NPM_EMAIL=gitlab@cenas.pt
     - NPM_REGISTRY=http://nexus.smeg.tecnico.ulisboa.pt/repository/npm-dsi    
    volumes:
     - ../:/porg
     - ./porg.yml:/porg/test/porg.yml
    links:
     - cas
     - mongo
     - consul

     

